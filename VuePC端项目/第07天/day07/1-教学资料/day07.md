## PC-day07

### 1.0 概述

#### 1.1 复习

+ 系统回顾了一下第五天的代码

+ 发布文章

  + 创建组件&路由

  + 完成静态页面

    + 频道的下拉框

      + 将它封装为一个单独的组件

      + 动态请求下拉的数据

      + 传递数据

        + 外界传入数据给下拉框，设置默认选中的下拉选项

          + 父传子

            + 父传

              + 通过给子组件设置自定义属性来传参

                ```html
                <son :abc="msg"></son>
                ```

            + 子接

              + 通过属性 props 来接收

                ```js
                {
                	props: ['abc'],
                	或者
                	props: {
                		abc: {
                			type: String,
                			default: ''	
                		}
                	}
                }
                ```

                

        + 改变下拉选项之后，将新的值返回给外界

          + 子传父

            + 子传

              + 在子组件调用自定义方法来传递参数

                ```js
                this.$emit('fnname', msg)
                ```

            + 父接

              + 给子组件实现方法

                ```html
                <son @fnname="getVal" />
                ```

              + 定义这个实现的方法

                ```js
                {
                	methods: {
                		getVal(val) {
                			console.log(val)
                		}
                	}
                }
                ```

        

  + 发送请求

    + 将所有的数据提交到服务器生成新的文章

  + 将文章内容的输入框改为富文本编辑器

    + 在 vue 中寻找资源
    + 查看 github 中文档的步骤
    + 了解富文本编辑框的使用步骤
    + 使用

+ 修改文章

  + 创建路由&组件（它与发布文章使用同一个组件）
  + 通过 $route.path.indexOf('edit') 判断是否是修改的逻辑
    + 再处理其它逻辑

#### 1.2 今日内容

+ 完成评论列表
  + 结构
  + 数据渲染
  + 关闭评论
+ 帐户信息
  + 结构
  + 数据渲染
  + 修改数据
+ 素材管理

### 2.0 完成评论列表

#### 2.1 功能预览

+ 评论数据的显示
+ 关闭评论

#### 2.2 完成功能

##### 2.2.1 完成静态页面

+ 添加组件&路由
+ 设置组件的入口
+ 完成静态页面

##### 2.2.2 动态渲染评论数据

+ 打开页面时请求服务器接口获取评论数据
  + 接口：
    + API：articles
    + method: GET
    + 参数：
      + query
        + status: 状态
        + channle_id：频道 id
        + begin_pubdate:开始时间
        + end_pubdate:结束时间
        + page：页码
        + per_page：页容量
        + response_type：
          + 不传：	返回的数据是文章列表
          + comment：返回的是评论列表
          + statistic：返回图片数据
+ 将评论数据动态渲染到表格中
  + 将数据保存到页面中
  + 将数据设置给表格作用数据源
  + 注意点：
    + element 中的 table 默认不能显示 boolen 值

##### 2.2.3 关闭评论

+ 给关闭评论按钮添加点击事件

+ 在事件中

  + 得到当前评论的 id

  + 发送请求到服务器关闭当前文章的评论

    + 接口

      + url: /comments/status

      + method: PUT

      + 参数：

        + query：
          + article_id ：要关闭评论的文章 id
        + body
          + allow_comment：boolean 是否允许评论
            + true 允许
            + false 不允许

        ```
        this.$http({
        	url: `/comments/status?article_id=${article_id}`,
        	method: 'PUT',
        	data: {
        		allow_comment: false
        	}
        })
        ```

  + 重新渲染页面

### 3.0 素材管理

#### 3.1 功能预览

+ 全部素材的展示
+ 收藏素材的展示
+ 点击收藏素材
+ 点击删除素材
+ 上传新的素材

#### 3.2 完成功能

##### 3.2.1 完成静态页面

+ 创建组件&路由
+ 设置入口
+ 完成结构样式

#### 3.3 功能

##### 3.3.1 完成素材的渲染

+ 打开页面时请求服务器获取素材信息
  + 接口：
    + url：user/images
    + method：GET
    + 参数：
      + Query
        + collect：
          + true   收藏的数据
          + false  全部的数据
        +  page：页码
        + per_page：页容量
+ 将素材信息动态渲染到页面上

##### 3.3.2 完成切换全部&收藏的数据

+ 给全部&收藏按钮添加 change 事件
  + 在事件中有一个参数 abc: 对应的就是单选框的中的 label 值
+ 在事件中
  + 分别请求不同的数据

##### 3.3.3 修改收藏后素材的显示状态

+ 如果元素是收藏的状态将星星设置为点亮

##### 3.3.4 点击收藏&取消收藏素材

+ 给收藏按钮添加点击事件
+ 在事件中：
  + 将当前元素的状态进行修改，将修改后的状态更新到服务器中
    + 接口
      + url: /user/images/:target
      + method: PUT
      + 参数
        + url：
          + target	收藏&取消收藏的素材 id
        + body
          + collect
            + true 添加收藏
            + false 取消收藏
  + 提示用户更新成功
  + 刷新数据

##### 3.3.5 删除素材

+ 给删除按钮添加点击事件
+ 在事件中
  + 得到要删除素材的 id
  + 调用服务器的删除素材接口，传入参数
    + 接口
      + url：user/images/:target
      + method: DELETE
      + 参数
        + url：
          + target	要删除的素材 id
    + 注意：
      + 删除成功后接口返回的内容为空
  + 提示用户删除成功
  + 刷新数据

##### 3.3.6 上传素材

+ 功能预览

  + 点击上传素材，打开一个新的面板
  + 在面板中点击上传图片的组件选项图片
  + 选项图片之后，图片自动上传
  + 关闭面板，数据显示

+ 步骤：

  + 给上传素材按钮添加点击事件

  + 在事件中：

    + 打开一个面板
    + 面板中显示
      + 上传组件
      + 关闭面板按钮

  + 点击上传组件可以选择图片，并进行上传

    + 必须给上传组件设置 action 属性

    + action 属性必须指定为我们自己的服务器接口

      + 接口
        + url：http://ttapi.research.itcast.cn/mp/v1_0/user/images
        + 方式：POST
        + 参数：
          + header:
            + Content-Type：multipart/form-data
            + Authorization: token
          + body
            + image 上传的图片

    + 设置以下属性：

      + action：要上传的服务器地址
      + headers：传入 Authorization 对应的 token
      + name：修改上传时文章对应的名称：必须改为 image

    + 返回的数据

      ```
      {
      	data: {
      		id: '',
      		url: ''
      	},
      	message: ''
      }
      ```

      

  + 点击关闭面板按钮刷新页面

### 4.0 帐户信息

##### 4.1 功能预览

+ 显示用户信息
+ 修改用户信息
+ 修改用户头像
+ 修改完成之后用户信息会自动更新

##### 4.2 完成静态页面

+ 组件&路由
+ 设置入口
+ 完成静态页面